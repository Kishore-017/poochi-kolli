<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgriDrone Pro - Field Mapping</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #1b5e20;
            --primary-light: #4c8c4a;
            --primary-dark: #003300;
            --secondary: #7cb342;
            --accent: #f9a825;
            --light: #f1f8e9;
            --dark: #212121;
            --error: #c62828;
            --success: #2e7d32;
            --warning: #ff6d00;
            --info: #0277bd;
            --gray: #f5f5f5;
            --gray-dark: #e0e0e0;
            --text-primary: #212121;
            --text-secondary: #757575;
            --text-light: #ffffff;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.16), 0 4px 6px rgba(0,0,0,0.23);
            --shadow-lg: 0 10px 20px rgba(0,0,0,0.19), 0 6px 6px rgba(0,0,0,0.23);
            --transition: all 0.3s cubic-bezier(.25,.8,.25,1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f8fbf8;
            color: var(--text-primary);
            line-height: 1.6;
            display: flex;
            min-height: 100vh;
        }
        
        /* Sidebar Styles */
        .sidebar {
            width: 280px;
            background: linear-gradient(to bottom, var(--primary), var(--primary-dark));
            color: white;
            padding: 20px 0;
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }
        
        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 20px;
        }
        
        .sidebar-logo {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .sidebar-logo i {
            font-size: 28px;
            margin-right: 10px;
            color: var(--accent);
        }
        
        .sidebar-logo h2 {
            font-size: 20px;
            font-weight: 600;
        }
        
        .sidebar-title {
            font-size: 16px;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 25px;
            margin-bottom: 15px;
            padding: 0 20px;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .menu-item {
            display: flex;
            align-items: center;
            padding: 14px 20px;
            color: white;
            text-decoration: none;
            transition: var(--transition);
            border-left: 4px solid transparent;
        }
        
        .menu-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
            border-left-color: var(--accent);
        }
        
        .menu-item.active {
            background-color: rgba(255, 255, 255, 0.15);
            border-left-color: var(--accent);
        }
        
        .menu-item i {
            width: 24px;
            margin-right: 15px;
            font-size: 18px;
        }
        
        .sidebar-user {
            margin-top: auto;
            padding: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
        }
        
        .sidebar-user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--accent);
            color: var(--dark);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-right: 12px;
        }
        
        .sidebar-user-name {
            font-weight: 500;
        }
        
        /* Main Content Area */
        .main-container {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            overflow: auto;
        }
        
        .container {
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            flex-grow: 1;
        }
        
        .header {
            background: linear-gradient(to right, var(--primary-dark), var(--primary));
            color: white;
            padding: 20px 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .logo {
            display: flex;
            align-items: center;
        }
        
        .logo i {
            font-size: 32px;
            margin-right: 15px;
            color: var(--accent);
        }
        
        .logo h1 {
            font-size: 28px;
            font-weight: 600;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background-color: var(--accent);
            color: var(--dark);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 20px;
        }
        
        .main-content {
            padding: 30px;
        }
        
        .section-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 25px;
            color: var(--primary-dark);
            display: flex;
            align-items: center;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--primary-light);
        }
        
        .section-title i {
            margin-right: 10px;
            color: var(--primary);
        }
        
        .mapping-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .mapping-option {
            background-color: var(--light);
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 280px;
            border: 2px solid transparent;
        }
        
        .mapping-option:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-md);
            border-color: var(--primary);
        }
        
        .option-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background-color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            color: var(--primary);
            font-size: 32px;
            box-shadow: var(--shadow-sm);
        }
        
        .option-title {
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--primary-dark);
        }
        
        .option-desc {
            font-size: 16px;
            color: var(--text-secondary);
            margin-bottom: 20px;
            line-height: 1.5;
        }
        
        .btn {
            padding: 12px 25px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }
        
        .btn i {
            margin-right: 8px;
        }
        
        .btn-primary {
            background-color: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .manual-input-form {
            display: none;
            background-color: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid var(--gray-dark);
        }
        
        .form-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--gray-dark);
        }
        
        .form-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--primary-dark);
        }
        
        .form-back {
            background-color: var(--light);
            color: var(--primary);
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            font-weight: 500;
            transition: var(--transition);
        }
        
        .form-back:hover {
            background-color: var(--primary);
            color: white;
        }
        
        .form-back i {
            margin-right: 8px;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--primary-dark);
            font-size: 16px;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid var(--gray-dark);
            border-radius: 8px;
            font-size: 16px;
            transition: var(--transition);
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(27, 94, 32, 0.2);
        }
        
        .form-select {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid var(--gray-dark);
            border-radius: 8px;
            font-size: 16px;
            background-color: white;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .form-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(27, 94, 32, 0.2);
        }
        
        .field-canvas-container {
            margin-top: 30px;
            border: 1px solid var(--gray-dark);
            border-radius: 8px;
            overflow: hidden;
            position: relative;
        }
        
        .canvas-header {
            background-color: var(--light);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--gray-dark);
        }
        
        .canvas-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--primary-dark);
        }
        
        .canvas-tools {
            display: flex;
            gap: 10px;
        }
        
        .tool-btn {
            padding: 10px 16px;
            border: 1px solid var(--gray-dark);
            border-radius: 6px;
            background-color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            font-size: 14px;
            transition: var(--transition);
        }
        
        .tool-btn i {
            margin-right: 5px;
        }
        
        .tool-btn.active {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .tool-btn:hover:not(.active) {
            background-color: var(--light);
        }
        
        .field-canvas {
            width: 100%;
            height: 500px;
            background-color: #f9f9f9;
            position: relative;
            overflow: hidden;
            background-image: 
                linear-gradient(rgba(0, 0, 0, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 0, 0, 0.05) 1px, transparent 1px);
            background-size: 20px 20px;
        }
        
        #fieldCanvas {
            width: 100%;
            height: 100%;
            cursor: crosshair;
        }
        
        .canvas-actions {
            padding: 20px;
            background-color: var(--light);
            border-top: 1px solid var(--gray-dark);
            display: flex;
            justify-content: flex-end;
            gap: 15px;
        }
        
        .btn-lg {
            padding: 14px 30px;
            font-size: 16px;
        }
        
        .btn-outline {
            background-color: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
            font-weight: 600;
        }
        
        .btn-outline:hover {
            background-color: var(--primary);
            color: white;
        }
        
        .instructions {
            background-color: var(--light);
            padding: 15px 20px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 4px solid var(--primary);
        }
        
        .instructions h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--primary-dark);
        }
        
        .instructions ul {
            padding-left: 20px;
            color: var(--text-secondary);
        }
        
        .instructions li {
            margin-bottom: 8px;
            line-height: 1.5;
        }
        
        .drone-scan-message {
            display: none;
            background-color: white;
            border-radius: 12px;
            padding: 60px 30px;
            text-align: center;
            margin-bottom: 30px;
            border: 1px solid var(--gray-dark);
        }
        
        .message-icon {
            font-size: 64px;
            color: var(--accent);
            margin-bottom: 20px;
        }
        
        .message-title {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--primary-dark);
        }
        
        .message-text {
            font-size: 18px;
            color: var(--text-secondary);
            margin-bottom: 30px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.6;
        }
        
        @media (max-width: 992px) {
            .mapping-options {
                grid-template-columns: 1fr;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                width: 70px;
            }
            
            .sidebar .menu-text,
            .sidebar .sidebar-title,
            .sidebar .sidebar-user-name {
                display: none;
            }
            
            .sidebar-header {
                padding: 0 10px 20px;
            }
            
            .menu-item {
                padding: 14px;
                justify-content: center;
            }
            
            .menu-item i {
                margin-right: 0;
            }
            
            .sidebar-user {
                justify-content: center;
                padding: 15px 10px;
            }
            
            .sidebar-user-avatar {
                margin-right: 0;
            }
        }
        
        @media (max-width: 768px) {
            body {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                padding: 10px 0;
            }
            
            .sidebar-header {
                padding: 0 15px 10px;
                margin-bottom: 10px;
            }
            
            .sidebar-logo {
                justify-content: center;
            }
            
            .menu-items-container {
                display: flex;
                overflow-x: auto;
                padding-bottom: 10px;
            }
            
            .menu-section {
                display: flex;
                flex-direction: row;
            }
            
            .menu-item {
                padding: 10px 15px;
                border-left: none;
                border-bottom: 4px solid transparent;
                flex-direction: column;
                text-align: center;
                min-width: 80px;
            }
            
            .menu-item:hover {
                border-left-color: transparent;
                border-bottom-color: var(--accent);
            }
            
            .menu-item.active {
                border-left-color: transparent;
                border-bottom-color: var(--accent);
            }
            
            .menu-item i {
                margin-bottom: 5px;
                font-size: 20px;
            }
            
            .menu-text {
                display: block;
                font-size: 12px;
            }
            
            .sidebar-title {
                display: none;
            }
            
            .sidebar-user {
                display: none;
            }
            
            .header {
                flex-direction: column;
                text-align: center;
                gap: 15px;
                padding: 15px;
            }
            
            .canvas-tools {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .canvas-actions {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar Menu -->
    <div class="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo">
                <i class="fas fa-drone"></i>
                <h2>AgriDrone Pro</h2>
            </div>
        </div>
        
        <div class="sidebar-title">Main Menu</div>
        <a href="hacka.html" class="menu-item">
            <i class="fas fa-th-large"></i>
            <span class="menu-text">Dashboard</span>
        </a>
        <a href="hacka5.html" class="menu-item active">
            <i class="fas fa-map-marked-alt"></i>
            <span class="menu-text">Field Mapping</span>
        </a>
        <a href="hacka1.html" class="menu-item">
            <i class="fas fa-drone"></i>
            <span class="menu-text">Drone Fleet</span>
        </a>
        
        <div class="sidebar-title">Operations</div>
        <a href="hacka6.html" class="menu-item">
            <i class="fas fa-play-circle"></i>
            <span class="menu-text">Mission Control</span>
        </a>
        <a href="hacka7.html" class="menu-item">
            <i class="fas fa-chart-bar"></i>
            <span class="menu-text">Spray Analytics</span>
        </a>
        <a href="hacka8.html" class="menu-item">
            <i class="fas fa-bug"></i>
            <span class="menu-text">Infection Tracking</span>
        </a>
        <a href="#" class="menu-item">
            <i class="fas fa-history"></i>
            <span class="menu-text">Mission History</span>
        </a>
        
        <div class="sidebar-title">Management</div>
        <a href="hacka9.html" class="menu-item">
            <i class="fas fa-flask"></i>
            <span class="menu-text">Chemical Inventory</span>
        </a>
        <a href="hacka10.html" class="menu-item">
            <i class="fas fa-cloud-sun"></i>
            <span class="menu-text">Weather Forecast</span>
        </a>
        
       
    </div>
    
    <!-- Main Content Area -->
    <div class="main-container">
        <div class="container">
            <!-- Header -->
            <div class="header">
                <div class="logo">
                    <i class="fas fa-map-marked-alt"></i>
                    <h1>AgriDrone Field Mapping</h1>
                </div>
                
                <div class="user-info">
                    <div class="user-avatar">FM</div>
                    <div class="user-details">
                        <div class="user-name">Farm Manager</div>
                    </div>
                </div>
            </div>
            
            
            <!-- Main Content -->
            <div class="main-content">
                <h1 class="section-title">
                    <i class="fas fa-map-marked-alt"></i> Field Mapping
                </h1>
                
                <!-- Mapping Options -->
                <div class="mapping-options" id="mappingOptions">
                    <div class="mapping-option" id="manualOption">
                        <div class="option-icon">
                            <i class="fas fa-pencil-alt"></i>
                        </div>
                        <h3 class="option-title">Manual Input</h3>
                        <p class="option-desc">Manually enter field details and create custom boundaries for irregular shaped lands</p>
                        <button class="btn btn-primary">
                            <i class="fas fa-pen"></i> Create Manual Map
                        </button>
                    </div>
                    
                    <div class="mapping-option" id="droneOption">
                        <div class="option-icon">
                            <i class="fas fa-drone"></i>
                        </div>
                        <h3 class="option-title">Drone Scanned Image</h3>
                        <p class="option-desc">Upload or import drone-captured imagery for automated field mapping</p>
                        <button class="btn btn-primary">
                            <i class="fas fa-upload"></i> Use Drone Image
                        </button>
                    </div>
                </div>
                
                <!-- Manual Input Form -->
                <div class="manual-input-form" id="manualForm">
                    <div class="form-header">
                        <h2 class="form-title">Manual Field Mapping</h2>
                        <button class="form-back" id="formBack">
                            <i class="fas fa-arrow-left"></i> Back to Options
                        </button>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Field Name</label>
                            <input type="text" class="form-input" placeholder="Enter field name" id="fieldName">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Crop Type</label>
                            <select class="form-select" id="cropType">
                                <option value="">Select crop type</option>
                                <option value="wheat">Wheat</option>
                                <option value="corn">Corn</option>
                                <option value="soybean">Soybean</option>
                                <option value="rice">Rice</option>
                                <option value="cotton">Cotton</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Area (acres)</label>
                            <input type="number" class="form-input" placeholder="Enter area in acres" id="fieldArea">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Soil Type</label>
                            <select class="form-select" id="soilType">
                                <option value="">Select soil type</option>
                                <option value="sandy">Sandy</option>
                                <option value="clay">Clay</option>
                                <option value="loam">Loam</option>
                                <option value="silt">Silt</option>
                                <option value="peat">Peat</option>
                                <option value="chalk">Chalk</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Irrigation System</label>
                            <select class="form-select" id="irrigationType">
                                <option value="">Select irrigation type</option>
                                <option value="drip">Drip Irrigation</option>
                                <option value="sprinkler">Sprinkler System</option>
                                <option value="flood">Flood Irrigation</option>
                                <option value="pivot">Center Pivot</option>
                                <option value="none">No Irrigation</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Planting Date</label>
                            <input type="date" class="form-input" id="plantingDate">
                        </div>
                    </div>
                    
                    <div class="field-canvas-container">
                        <div class="canvas-header">
                            <h3 class="canvas-title">Field Boundary Editor</h3>
                            <div class="canvas-tools">
                                <button class="tool-btn active" id="drawTool">
                                    <i class="fas fa-pencil-alt"></i> Draw
                                </button>
                                <button class="tool-btn" id="moveTool">
                                    <i class="fas fa-arrows-alt"></i> Move
                                </button>
                                <button class="tool-btn" id="reshapeTool">
                                    <i class="fas fa-edit"></i> Reshape
                                </button>
                                <button class="tool-btn" id="clearTool">
                                    <i class="fas fa-trash-alt"></i> Clear
                                </button>
                            </div>
                        </div>
                        
                        <div class="field-canvas">
                            <canvas id="fieldCanvas"></canvas>
                        </div>
                        
                        <div class="canvas-actions">
                            <button class="btn btn-outline btn-lg" id="cancelBtn">
                                <i class="fas fa-times"></i> Cancel
                            </button>
                            <button class="btn btn-primary btn-lg" id="saveBtn">
                                <i class="fas fa-save"></i> Save Field Map
                            </button>
                        </div>
                    </div>
                    
                    <div class="instructions">
                        <h3>How to create your field boundary:</h3>
                        <ul>
                            <li>Select the <strong>Draw</strong> tool and click on the canvas to add points</li>
                            <li>Use the <strong>Move</strong> tool to reposition the entire boundary</li>
                            <li>Use the <strong>Reshape</strong> tool to adjust individual points</li>
                            <li>Click <strong>Clear</strong> to start over if needed</li>
                            <li>Create at least 3 points to form a closed shape</li>
                        </ul>
                    </div>
                </div>
                
                <!-- Drone Scan Message -->
                <div class="drone-scan-message" id="droneMessage">
                    <div class="message-icon">
                        <i class="fas fa-cogs"></i>
                    </div>
                    <h2 class="message-title">Feature Coming Soon</h2>
                    <p class="message-text">
                        The drone scanned image processing feature is currently under development. 
                        Our team is working hard to bring you automated field mapping from drone imagery.
                        Please use the manual input option for now.
                    </p>
                    <button class="btn btn-primary" id="messageBack">
                        <i class="fas fa-arrow-left"></i> Back to Options
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // DOM elements
        const mappingOptions = document.getElementById('mappingOptions');
        const manualOption = document.getElementById('manualOption');
        const droneOption = document.getElementById('droneOption');
        const manualForm = document.getElementById('manualForm');
        const droneMessage = document.getElementById('droneMessage');
        const formBack = document.getElementById('formBack');
        const messageBack = document.getElementById('messageBack');
        const cancelBtn = document.getElementById('cancelBtn');
        const saveBtn = document.getElementById('saveBtn');
        
        const canvas = document.getElementById('fieldCanvas');
        const ctx = canvas.getContext('2d');
        
        // Form fields
        const fieldName = document.getElementById('fieldName');
        const cropType = document.getElementById('cropType');
        const fieldArea = document.getElementById('fieldArea');
        const soilType = document.getElementById('soilType');
        const irrigationType = document.getElementById('irrigationType');
        const plantingDate = document.getElementById('plantingDate');
        
        // Tool buttons
        const drawTool = document.getElementById('drawTool');
        const moveTool = document.getElementById('moveTool');
        const reshapeTool = document.getElementById('reshapeTool');
        const clearTool = document.getElementById('clearTool');
        
        // Drawing variables
        let isDrawing = false;
        let points = [];
        let selectedPoint = null;
        let activeTool = 'draw';
        
        // Canvas setup
        function setupCanvas() {
            // Set canvas dimensions
            const container = canvas.parentElement;
            canvas.width = container.offsetWidth;
            canvas.height = container.offsetHeight;
            
            // Draw grid background
            drawGrid();
            
            // Draw instructions if no points
            if (points.length === 0) {
                drawInstructions();
            } else {
                drawFieldBoundary();
            }
        }
        
        // Draw grid background
        function drawGrid() {
            const width = canvas.width;
            const height = canvas.height;
            const gridSize = 20;
            
            ctx.clearRect(0, 0, width, height);
            ctx.fillStyle = '#f9f9f9';
            ctx.fillRect(0, 0, width, height);
            
            ctx.beginPath();
            ctx.strokeStyle = '#e0e0e0';
            ctx.lineWidth = 0.5;
            
            // Draw vertical lines
            for (let x = 0; x <= width; x += gridSize) {
                ctx.moveTo(x, 0);
                ctx.lineTo(x, height);
            }
            
            // Draw horizontal lines
            for (let y = 0; y <= height; y += gridSize) {
                ctx.moveTo(0, y);
                ctx.lineTo(width, y);
            }
            
            ctx.stroke();
        }
        
        // Draw instructions
        function drawInstructions() {
            const width = canvas.width;
            const height = canvas.height;
            
            ctx.font = '18px sans-serif';
            ctx.fillStyle = '#9e9e9e';
            ctx.textAlign = 'center';
            ctx.fillText('Click to add points and create your field boundary', width / 2, height / 2);
            
            ctx.font = '14px sans-serif';
            ctx.fillText('Use the tools above to draw, move, or reshape your field', width / 2, height / 2 + 30);
        }
        
        // Draw field boundary
        function drawFieldBoundary() {
            drawGrid();
            
            if (points.length > 0) {
                // Draw the polygon
                ctx.beginPath();
                ctx.fillStyle = 'rgba(76, 175, 80, 0.3)';
                ctx.strokeStyle = '#2e7d32';
                ctx.lineWidth = 3;
                
                ctx.moveTo(points[0].x, points[0].y);
                for (let i = 1; i < points.length; i++) {
                    ctx.lineTo(points[i].x, points[i].y);
                }
                
                if (points.length > 2) {
                    ctx.closePath();
                    ctx.fill();
                    ctx.stroke();
                } else {
                    ctx.stroke();
                }
                
                // Draw the points
                for (let i = 0; i < points.length; i++) {
                    ctx.beginPath();
                    ctx.fillStyle = selectedPoint === i ? '#ff6d00' : '#2e7d32';
                    ctx.arc(points[i].x, points[i].y, 8, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Draw point index
                    ctx.fillStyle = 'white';
                    ctx.font = 'bold 12px Arial';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText((i + 1).toString(), points[i].x, points[i].y);
                }
                
                // Calculate and display area
                if (points.length > 2) {
                    const area = calculateArea();
                    ctx.fillStyle = '#1565c0';
                    ctx.font = 'bold 16px Arial';
                    ctx.textAlign = 'right';
                    ctx.textBaseline = 'top';
                    ctx.fillText(`Estimated Area: ${area.toFixed(2)} acres`, canvas.width - 20, 20);
                }
            }
        }
        
        // Calculate polygon area
        function calculateArea() {
            let total = 0;
            for (let i = 0; i < points.length; i++) {
                const addX = points[i].x;
                const addY = points[i == points.length - 1 ? 0 : i + 1].y;
                const subX = points[i == points.length - 1 ? 0 : i + 1].x;
                const subY = points[i].y;
                
                total += (addX * addY * 0.5);
                total -= (subX * subY * 0.5);
            }
            
            // Convert pixels to acres (this is a simplified conversion)
            return Math.abs(total) / 10000;
        }
        
        // Get mouse position relative to canvas
        function getMousePos(e) {
            const rect = canvas.getBoundingClientRect();
            return {
                x: e.clientX - rect.left,
                y: e.clientY - rect.top
            };
        }
        
        // Get touch position relative to canvas
        function getTouchPos(e) {
            const rect = canvas.getBoundingClientRect();
            const touch = e.touches[0];
            return {
                x: touch.clientX - rect.left,
                y: touch.clientY - rect.top
            };
        }
        
        // Check if point is near another point
        function isNearPoint(point, x, y) {
            return Math.sqrt((point.x - x) ** 2 + (point.y - y) ** 2) < 15;
        }
        
        // Event listeners for option selection
        manualOption.addEventListener('click', function() {
            mappingOptions.style.display = 'none';
            manualForm.style.display = 'block';
            setupCanvas();
        });
        
        droneOption.addEventListener('click', function() {
            mappingOptions.style.display = 'none';
            droneMessage.style.display = 'block';
        });
        
        // Back buttons
        formBack.addEventListener('click', function() {
            manualForm.style.display = 'none';
            mappingOptions.style.display = 'grid';
        });
        
        messageBack.addEventListener('click', function() {
            droneMessage.style.display = 'none';
            mappingOptions.style.display = 'grid';
        });
        
        // Cancel button
        cancelBtn.addEventListener('click', function() {
            if (confirm('Are you sure you want to cancel? All changes will be lost.')) {
                points = [];
                setupCanvas();
                
                // Clear form fields
                fieldName.value = '';
                cropType.value = '';
                fieldArea.value = '';
                soilType.value = '';
                irrigationType.value = '';
                plantingDate.value = '';
            }
        });
        
        // Save button
        saveBtn.addEventListener('click', function() {
            if (points.length < 3) {
                alert('Please create a valid field boundary with at least 3 points');
                return;
            }
            
            if (!fieldName.value || !cropType.value) {
                alert('Please fill in all required field details');
                return;
            }
            
            // Calculate area if not entered
            if (!fieldArea.value) {
                const area = calculateArea();
                fieldArea.value = area.toFixed(2);
            }
            
            // In a real application, you would save the data here
            alert(`Field "${fieldName.value}" saved successfully!`);
        });
        
        // Tool buttons
        drawTool.addEventListener('click', function() {
            setActiveTool('draw');
        });
        
        moveTool.addEventListener('click', function() {
            setActiveTool('move');
        });
        
        reshapeTool.addEventListener('click', function() {
            setActiveTool('reshape');
        });
        
        clearTool.addEventListener('click', function() {
            if (confirm('Are you sure you want to clear the field boundary?')) {
                points = [];
                selectedPoint = null;
                drawFieldBoundary();
            }
        });
        
        function setActiveTool(tool) {
            activeTool = tool;
            
            // Update button styles
            drawTool.classList.toggle('active', tool === 'draw');
            moveTool.classList.toggle('active', tool === 'move');
            reshapeTool.classList.toggle('active', tool === 'reshape');
        }
        
        // Mouse events for canvas
        canvas.addEventListener('mousedown', function(e) {
            const pos = getMousePos(e);
            
            if (activeTool === 'draw') {
                points.push({ x: pos.x, y: pos.y });
                drawFieldBoundary();
            } else if (activeTool === 'reshape') {
                // Check if clicking on a point
                for (let i = 0; i < points.length; i++) {
                    if (isNearPoint(points[i], pos.x, pos.y)) {
                        selectedPoint = i;
                        isDrawing = true;
                        break;
                    }
                }
            } else if (activeTool === 'move') {
                // Check if clicking on a point
                for (let i = 0; i < points.length; i++) {
                    if (isNearPoint(points[i], pos.x, pos.y)) {
                        selectedPoint = i;
                        isDrawing = true;
                        break;
                    }
                }
            }
        });
        
        canvas.addEventListener('mousemove', function(e) {
            if (!isDrawing) return;
            
            const pos = getMousePos(e);
            
            if (activeTool === 'reshape' && selectedPoint !== null) {
                points[selectedPoint] = { x: pos.x, y: pos.y };
                drawFieldBoundary();
            } else if (activeTool === 'move' && selectedPoint !== null) {
                const dx = pos.x - points[selectedPoint].x;
                const dy = pos.y - points[selectedPoint].y;
                
                for (let i = 0; i < points.length; i++) {
                    points[i].x += dx;
                    points[i].y += dy;
                }
                
                drawFieldBoundary();
            }
        });
        
        canvas.addEventListener('mouseup', function() {
            isDrawing = false;
            selectedPoint = null;
        });
        
        canvas.addEventListener('mouseleave', function() {
            isDrawing = false;
            selectedPoint = null;
        });
        
        // Touch events for mobile devices
        canvas.addEventListener('touchstart', function(e) {
            e.preventDefault();
            const pos = getTouchPos(e);
            
            if (activeTool === 'draw') {
                points.push({ x: pos.x, y: pos.y });
                drawFieldBoundary();
            } else if (activeTool === 'reshape') {
                // Check if touching on a point
                for (let i = 0; i < points.length; i++) {
                    if (isNearPoint(points[i], pos.x, pos.y)) {
                        selectedPoint = i;
                        isDrawing = true;
                        break;
                    }
                }
            } else if (activeTool === 'move') {
                // Check if touching on a point
                for (let i = 0; i < points.length; i++) {
                    if (isNearPoint(points[i], pos.x, pos.y)) {
                        selectedPoint = i;
                        isDrawing = true;
                        break;
                    }
                }
            }
        });
        
        canvas.addEventListener('touchmove', function(e) {
            e.preventDefault();
            if (!isDrawing) return;
            
            const pos = getTouchPos(e);
            
            if (activeTool === 'reshape' && selectedPoint !== null) {
                points[selectedPoint] = { x: pos.x, y: pos.y };
                drawFieldBoundary();
            } else if (activeTool === 'move' && selectedPoint !== null) {
                const dx = pos.x - points[selectedPoint].x;
                const dy = pos.y - points[selectedPoint].y;
                
                for (let i = 0; i < points.length; i++) {
                    points[i].x += dx;
                    points[i].y += dy;
                }
                
                drawFieldBoundary();
            }
        });
        
        canvas.addEventListener('touchend', function() {
            isDrawing = false;
            selectedPoint = null;
        });
        
        // Initialize canvas on load
        window.addEventListener('load', function() {
            // Set today's date as default for planting date
            const today = new Date();
            const yyyy = today.getFullYear();
            let mm = today.getMonth() + 1;
            let dd = today.getDate();
            
            if (dd < 10) dd = '0' + dd;
            if (mm < 10) mm = '0' + mm;
            
            const formattedToday = yyyy + '-' + mm + '-' + dd;
            plantingDate.value = formattedToday;
            
            // Add resize handler
            window.addEventListener('resize', function() {
                if (manualForm.style.display === 'block') {
                    setupCanvas();
                }
            });
        });
    </script>
</body>
</html>